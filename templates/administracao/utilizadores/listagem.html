{% extends 'template.html' %}


{% block content %}
    <h2>Listagem de Utilizadores</h2>

    <form class="form-inline" style="float: right" method="post" action="admUtilizadores">
        <label class="sr-only" for="procurar">Procurar</label>
        <input type="text" name="search" class="form-control mb-2 mr-sm-2" id="procurar"
               value="{% if data["search"] is defined %}{{ data["search"] }}{% endif %}">

        <button type="submit" class="btn btn-primary mb-2">Pesquisar</button>
    </form>

    <table class="table table-striped">
        <thead>
        <tr>
            <th scope="col" width="10%">CÃ³digo</th>
            <th scope="col" width="30%">Nome</th>
            <th scope="col" width="46%">Email</th>
            <th scope="col" width="14%"></th>
        </tr>
        </thead>
        <tbody>
        {% for result in data["users"] %}
            <tr>
                <td>{{ result["username"] }}</td>
                <td>{{ result["name"] }}</td>
                <td>{{ result["email"] }}</td>
                <td>
                    <a class="edit btn btn-warning text-white" title="Editar" data-toggle="tooltip"
                       href="admUtilizadores/{{ result["id"] }}">
                        <i class="fas fa-edit"></i>
                    </a>
                    <a class="delete btn btn-danger" title="Eliminar" onclick="deleteUser({{ result["id"] }})" id="deleteUser{{ result["id"] }}"
                       data-toggle="tooltip">
                        <i class="fas fa-trash-alt"></i>
                    </a>
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <button type="button" style="float: left" class="btn btn-success add-new"><i class="fa fa-plus"></i> Criar</button>

    <script>
        function deleteUser(id) {
            let url = "http://localhost:5000/user/" + id;
            fetch(url, {
                method: "DELETE", // or 'PUT'
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer {{ session['access_token'] }}'
                },
            }).then(response => {
                response.json().then(data => {
                    if (response.status == 200 || response.status == 201) {
                        document.getElementById("deleteUser"+id).parentElement.parentElement.remove()
                    } else
                        alert("Status " + response.status + " - " + response.statusText + " " + data["message"]);
                });
            }).catch((error) => {
                console.error('Error:', error);
            });
        }
    </script>

{% endblock %}

